<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<html lang="zh-Hant" type="text/html; charset=UTF-8">
<title>仿星穹鐵道─小遊戲</title>
<body>
<script src="jquery-3.7.1.js" type="application/javascript" ></script>
<canvas id="myCanvas" width="1600" height="2000"></canvas>
<div id="image-container" style="display:none"></div>
<script type="application/javascript" charset="UTF-8">

var c=document.getElementById("myCanvas");
var canvas_2 = document.createElement("canvas");
//canvas_2不顯示在網頁上,它用於處理非同步圖片載入順序
canvas_2.setAttribute("height",600);
canvas_2.setAttribute("width",600);
//var ctx=c.getContext("2d");
var ctx =c.getContext("2d", { willReadFrequently: true })
var ctx_2 =canvas_2.getContext("2d", { willReadFrequently: true })

const container = document.getElementById("image-container");
container.appendChild(canvas_2);



ctx.fillStyle="#000000";

//start 	224 190
//end		216 181
//l		218 185
//l45r45	216 188
//u90r45	216 179

//中間的小圓 45*45
//通道 20*70
//正六邊形邊長 110

//var start_unit = new temp_design("起始","hex_circle_part_full_pin.png",554,300+190,3,220,192);

//var end_unit = new temp_design("結束","end.jpg",554,300-190,3,216,181);
//var end_unit = new temp_design("結束","end.png",554,300-190,3,220,192);

//var l_unit = new temp_design("直線","l.jpg",554,300,3,218,185);
//var l_unit = new temp_design("直線","l.png",554,300,3,220,192);
var l_unit = new temp_design("直線","l.png",554,151,3,220,192);


//var l45r45_unit = new temp_design("左45右45","l45r45.jpg",554-190,390-188,3,216,188);
//var l45r45_unit = new temp_design("左45右45","l45r45.png",554-165,396-190,3,220,192);

//var u90r45_unit = new temp_design("上90右45","u90r45.jpg",554-190,390,3,216,179);
//var u90r45_unit = new temp_design("上90右45","u90r45.png",554-165,396,3,220,192);
var u90r45_unit = new temp_design("上90右45","u90r45.png",554-165,247,3,220,192);


console.log((Math.sqrt(3) / 2 * 1 + Math.sqrt(3) * 1) * 95);
console.log((Math.sqrt(3) / 2 * 0 + Math.sqrt(3) * 1) * 95);


var elements = [];
//elements.push(start_unit,end_unit,l_unit,l45r45_unit,u90r45_unit);
elements.push(l_unit,u90r45_unit);



var rotate_x=0;

function temp_design(id,img,left,top,zIndex,width,height)
{
this.id=id;
//this.image = img;
this.image = new Image();
this.image.src=img;
var self=this;
this.image.onload = function(){self.draw_flag=true; re_draw();}

this.left= left;
this.top= top;
this.zIndex = zIndex;
this.width=width;
this.height=height;
this.draw_flag = false;

$(c).on('handleClick', function(e, mouse) {

        if (self.left < mouse.x &&
            self.left + self.width > mouse.x &&
            self.top < mouse.y &&
            self.top + self.height > mouse.y) {
self.draw_flag = false;

	//ctx.clearRect(0,0,c.width,c.height);
	ctx_2.clearRect(0,0,c.width,c.height);
	ctx_2.drawImage(self.image,0,0);


	imgData = ctx_2.getImageData(0,0,canvas_2.width,canvas_2.height);
console.log("RGB" + imgData.data[50*4*canvas_2.width+70*4+2]);
console.log("RGB" + imgData.data[50*4*canvas_2.width+105*4+2]);
console.log("RGB" + imgData.data[50*4*canvas_2.width+150*4+2]);

console.log("RGB" + imgData.data[130*4*canvas_2.width+70*4+2]);
console.log("RGB" + imgData.data[130*4*canvas_2.width+105*4+2]);
console.log("RGB" + imgData.data[130*4*canvas_2.width+150*4+2]);


	ctx_2.translate(self.width/2,self.height/2);
	ctx_2.rotate( 60 * Math.PI / 180 );

	/*ctx_2.transform(
		Math.cos( 60 * Math.PI / 180),
		Math.sin( 60 * Math.PI / 180),
		-Math.sin( 60 * Math.PI / 180),
		Math.cos( 60 * Math.PI / 180),1,1);
	//兩種寫法效果相同,都是對x軸逆時針旋轉
	*/

	ctx_2.translate(-self.width/2,-self.height/2);

	re_draw();

	ctx.putImageData(imgData,self.left,self.top,0,0,self.width,self.height);
	ctx.drawImage(elements[0].image,554,300+190);
	ctx.drawImage(elements[1].image,554,300-190);
	ctx.drawImage(elements[2].image,554,300);
	ctx.drawImage(elements[3].image,554-165,396-190);
	ctx.drawImage(elements[4].image,554-165,396);
        }
    });
}


function re_draw()
{
ctx.clearRect(0,0,c.width,c.height);

elements.forEach(function(element) {
	if(element.draw_flag)
	{
		ctx.drawImage(element.image,element.left, element.top,element.width,element.height);
	}
});

}

re_draw();


$(c).on('click', function(e) {
var mouse= {
        x: e.pageX - c.offsetLeft,
        y: e.pageY - c.offsetTop
}
         
    //fire off synthetic event containing mouse coordinate info
    $(c).trigger('handleClick', [mouse]);

});


</script>

</body>
</html>